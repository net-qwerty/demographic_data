@page "/form"
@using System;
@using System.Reflection;
@inject HttpClient Http;

<PageTitle>Form</PageTitle>

<h1><b>Демографический опрос</b></h1>

@foreach (var field in fields)
    {
        
        <h3>@field.Title</h3>

        <input placeholder=@field.Name @bind=field.Value/>
    
    }

<button class="btn btn-primary" @onclick="SendForm">Отправить анкету</button>
<p role="status">Current count: @currentCount</p>

<h2><b>Ваша Анкета</b></h2>

@foreach (var field in fields)
    {
        
        <h3>@field.Title :</h3>
        <body>
        @field.Value
        </body>
        
    
    }

@code {
    private List<Field> fields {get; set; }
    
    private List<FormItem> addItem {get; set; }
    
    @* private Form  addItem = new Form(); *@
    protected override async Task OnInitializedAsync()
    {
        fields = new List<Field>()
        {
            new Field()
            {
                Title = "День рождения",
                Name = "Birthday",
                Value = ""
            },
            new Field()
            {
                Title = "Пол",
                Name = "Gender",
                Value = ""
            },
            new Field()
            {
                Title = "Место рождения",
                Name = "PlaceOfBirth",
                Value = ""
            },
            new Field()
            {
                Title = "Образование",
                Name = "Education",
                Value = ""
            },
            new Field()
            {
                Title = "Семейное положение",
                Name = "FamilyStatus",
                Value = ""
            },
            new Field()
            {
                Title = "Место работы",
                Name = "Employment",
                Value = ""
            },
            new Field()
            {
                Title = "Уровень дохода",
                Name = "IncomeLevel",
                Value = ""
            },
            new Field()
            {
                Title = "Доход",
                Name = "Revenue",
                Value = ""
            },
        };
    }
    private int currentCount = 0;

    private async Task SendForm()
        {
        
        var addItem = new FormItem 
        {
        Birthday = fields[1].Value,

        Gender = fields[2].Value,

        PlaceOfBirth = fields[3].Value,

        Education = fields[4].Value,

        FamilyStatus = fields[5].Value,

        Employment = fields[6].Value

        };

        await Http.PostAsJsonAsync("formitems", addItem);

        for(int i = 0; i < fields.Count; i++ )
            {
                fields[i].Value = "";
            }
        currentCount++;
        }
    }
}
